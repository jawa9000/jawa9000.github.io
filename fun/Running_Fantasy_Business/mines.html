<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
    <title>Mine Output</title>
    <meta name='description' content='mine output'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name="keywords" content="javascript, random">
    <meta name="author" content="Brian Immel">
    <meta name="level" content="2">
    <meta name="version" content="0.0.1">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">
    <link href="../../css/normalize.css" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet"> -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <style>
        .center {
            text-align: center;
        }
        input {
            width: 60px;
        }
        h1, h2 {
            text-align: center;
        }
        td, th {
            padding: 5px;
        }
        /* table elements */
        table, th, td {
            border: 1px solid black;
            padding: 5px;
        }
        th {
            text-align: center;
            background-color: rgb(101, 97, 148);
            color: white;
        }
        tr:nth-child(odd) {
            background-color: rgb(133, 127, 194);
        }
        tr:nth-child(even) {
            background-color: rgb(169, 165, 209);
        }
        tr:hover {
            background-color: rgb(195, 192, 231);
        }

    </style>
</head>

<body>
    <h1 class="center">Mine Output</h1>
    <div class="container">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <label for="percentage_dragonTip">Dragon's cut (%)</label>
                <input id="percentage_dragonTip" type="number" min="0" step="1" max="100" value="50">
                <label for="percentage_minerTip">Miner's cut (%)</label>
                <input id="percentage_minerTip" type="number" min="0" step="1" max="100" value="2">
                <label for="percentage_mineUpkeep">Mine upkeep (%)</label>
                <input id="percentage_mineUpkeep" type="number" min="0" step="1" max="100" value="12">
                <label for="percentage_miscExpenses">Mine expenses (%)</label>
                <input id="percentage_miscExpenses" type="number" min="0" step="1" max="100" value="6">
                <label for="percentage_mineExpansion">Mine expansion (%)</label>
                <input id="percentage_mineExpansion" type="number" min="0" step="1" max="100" value="10">
                <br/>
                <label for="days">Days</label>
                <input id="days" type="number" min="1" step="1" max="365" value="30">
                <label for="minerCount"># of Miners</label>
                <input id="minerCount" type="number" min="1" step="1" value="10">
                <button>Run</button>
            </div>
            <div class="col-md-1"></div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-6">
                <div id="summary"></div>
            </div>
            <div class="col-md-4">
                <div id="output"></div>
            </div>
            <div class="col-md-1"></div>
        </div>
    </div>
</body>

    <script src="../../js/jquery-2.1.0.min.js"></script>    

    <script>
        /*
            https://angrygolem-games.com/dwarves-mining-4-dd-mining-guide-mining-output/
        */
        let minedOutput = {
            'granite': {
                'name': 'Granite',
                'gpOutput': [1,2,3,4,5,6,7,8,9,10,11,12]
            },
            'basalt': {
                'name': 'Basalt',
                'gpOutput': [2,4,6,8,10,12,14,16,20,22,24]
            },
            'marble': {
                'name': 'Marble',
                'gpOutput': [4,8,16,32,36,40,44,48,52,56,60,67]
            },
            'coal': {
                'name': 'Coal',
                'gpOutput': [2,4,6,8,10,12,14,16,18,20,22,24]
            },
            'petroleum': {
                'name': 'Petroleum',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'agate': {
                'name': 'agate',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'bloodstone': {
                'name': 'bloodstone',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'canelian': {
                'name': 'canelian',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'citrine': {
                'name': 'citrine',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'jasper': {
                'name': 'jasper',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'moonstone': {
                'name': 'moonstone',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'onyx': {
                'name': 'onyx',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'tourmaline': {
                'name': 'tourmaline',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'zircon': {
                'name': 'zircon',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'fluorite': {
                'name': 'fluorite',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'obsidian': {
                'name': 'obsidian',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'quartz': {
                'name': 'quartz',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'amethyst': {
                'name': 'amethyst',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'lapis lazuli': {
                'name': 'lapis lazuli',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'aquamarine': {
                'name': 'aquamarine',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'blueSpinel': {
                'name': 'blue spinel',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'peridot': {
                'name': 'peridot',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'topaz': {
                'name': 'topaz',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'garnet': {
                'name': 'garnet',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'jacinth': {
                'name': 'jacinth',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'opal': {
                'name': 'opal',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'redSpinel': {
                'name': 'red spinel',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'sapphire': {
                'name': 'sapphire',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'emerald': {
                'name': 'emerald',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'ruby': {
                'name': 'ruby',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'diamond': {
                'name': 'diamond',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'radioactive': {
                'name': 'radioactive',
                'gpOutput': [9,13,17,21,25,29,33,37,41,45,49,63]
            },
            'lead': {
                'name': 'Lead',
                'gpOutput': [1,2,3,4,5,6,7,8,9,10,11,12]
            },
            'zinc': {
                'name': 'Zinc',
                'gpOutput': [2,4,6,8,10,12,14,16,20,22,24]
            },
            'iron': {
                'name': 'Iron',
                'gpOutput': [4,7,10,13,16,19,22,25,28,31,34,37]
            },
            'tin': {
                'name': 'Tin',
                'gpOutput': [7,11,15,19,23,27,31,35,39,43,47,51]
            },
            'copper': {
                'name': 'Copper',
                'gpOutput': [10,15,20,25,30,35,40,45,50,55,60,65]
            },
            'silver': {
                'name': 'Silver',
                'gpOutput': [20,30,40,50,60,70,80,90,100,110,120,130]
            },
            'gold': {
                'name': 'Gold',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'platinum': {
                'name': 'Platinum',
                'gpOutput': [80,130,177,225,275,320,370,420,465,560,610,660]
            },
            'mithril': {
                'name': 'Mithril',
                'gpOutput': [150,210,280,340,410,480,550,620,690,770,830,910]
            },
            'adamantine': {
                'name': 'Adamantine',
                'gpOutput': [200,300,400,500,600,700,800,900,1000,1100,1200,1300]
            }
        }

        let miningProducts = {
            'stones': {
                'name': 'stones',
                'first': 0,
                'second': 64
            },
            'metals': {
                'name': 'metals',
                'first': 65,
                'second': 82
            },
            'exotics': {
                'name': 'exotics',
                'first': 83,
                'second': 92
            },
            'gemstones': {
                'name': 'gemstones',
                'first': 93,
                'second': 99
            }
        }
        
        let metals = {
            'lead': {
                'name': 'lead',
                'first': 0,
                'second': 4,
                'gpOutput': [1,2,3,4,5,6,7,8,9,10,11,12]
            },
            'zinc': {
                'name': 'zinc',
                'first': 5,
                'second': 9,
                'gpOutput': [2,4,6,8,10,12,14,16,20,22,24]
            },
            'iron': {
                'name': 'iron',
                'first': 10,
                'second': 59,
                'byproduct': 'ironTable',
                'gpOutput': [4,7,10,13,16,19,22,25,28,31,34,37]
            },
            'tin': {
                'name': 'tin',
                'first': 60,
                'second': 69,
                'gpOutput': [7,11,15,19,23,27,31,35,39,43,47,51]
            },
            'copper': {
                'name': 'copper',
                'first': 70,
                'second': 84,
                'byproduct': 'copperTable',
                'gpOutput': [10,15,20,25,30,35,40,45,50,55,60,65]
            },
            'silver': {
                'name': 'silver',
                'first': 85,
                'second': 89,
                'gpOutput': [20,30,40,50,60,70,80,90,100,110,120,130]
            },
            'gold': {
                'name': 'gold',
                'first': 90,
                'second': 94,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'platinum': {
                'name': 'platinum',
                'first': 95,
                'second': 96,
                'gpOutput': [80,130,177,225,275,320,370,420,465,560,610,660]
            },
            'mithril': {
                'name': 'mithril',
                'first': 97,
                'second': 98,
                'gpOutput': [150,210,280,340,410,480,550,620,690,770,830,910]
            },
            'adamantine': {
                'name': 'adamantine',
                'first': 99,
                'second': 100,
                'gpOutput': [200,300,400,500,600,700,800,900,1000,1100,1200,1300]
            }
        }

        let stones = {
            'granite': {
                'name': 'granite',
                'first': 0,
                'second': 59,
                'gpOutput': [1,2,3,4,5,6,7,8,9,10,11,12]
            },
            'basalt': {
                'name': 'basalt',
                'first': 60,
                'second': 89,
                'gpOutput': [2,4,6,8,10,12,14,16,20,22,24]
            },
            'marble': {
                'name': 'marble',
                'first': 90,
                'second': 99,
                'gpOutput': [4,8,16,32,36,40,44,48,52,56,60,67]
            }
        }

        let exotics = {
            'coal': {
                'name': 'coal',
                'first': 0,
                'second': 59,
                'byproduct': 'amber-jet',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'petroleum': {
                'name': 'petroleum',
                'first': 60,
                'second': 89,
                'byproduct': 'blue calcite',
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'radioactive': {
                'name': 'radioactive',
                'first': 90,
                'second': 99,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            }
        }

        let gemstones = {
            'aquamarine': {
                'name': 'aquamarine',
                'first': 0,
                'second': 14,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'blueSpinel': {
                'name': 'blueSpinel',
                'first': 15,
                'second': 29,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'peridot': {
                'name': 'peridot',
                'first': 30,
                'second': 44,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'topaz': {
                'name': 'topaz',
                'first': 45,
                'second': 59,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'garnet': {
                'name': 'garnet',
                'first': 60,
                'second': 67,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'jacinth': {
                'name': 'jacinth',
                'first': 68,
                'second': 75,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'opal': {
                'name': 'opal',
                'first': 76,
                'second': 83,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'redSpinel': {
                'name': 'redSpinel',
                'first': 84,
                'second': 90,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'sapphire': {
                'name': 'sapphire',
                'first': 91,
                'second': 93,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'emerald': {
                'name': 'emerald',
                'first': 94,
                'second': 95,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'ruby': {
                'name': 'ruby',
                'first': 96,
                'second': 97,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            },
            'diamond': {
                'name': 'diamond',
                'first': 98,
                'second': 99,
                'gpOutput': [35,55,77,100,135,155,175,200,220,235,260]
            }
        }

        let graniteByProducts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'agate': {
                'name': 'agate',
                'first': 50,
                'second': 69
            },
            'bloodstone': {
                'name': 'bloodstone',
                'first': 70,
                'second': 71
            },
            'canelian': {
                'name': 'canelian',
                'first': 72,
                'second': 74
            },
            'citrine': {
                'name': 'citrine',
                'first': 75,
                'second': 77
            },
            'jasper': {
                'name': 'jasper',
                'first': 78,
                'second': 80
            },
            'moonstone': {
                'name': 'moonstone',
                'first': 81,
                'second': 83
            },
            'onyx': {
                'name': 'onyx',
                'first': 84,
                'second': 86
            },
            'tourmaline': {
                'name': 'tourmaline',
                'first': 87,
                'second': 89
            },
            'zircon': {
                'name': 'zircon',
                'first': 90,
                'second': 92
            },
            'fluorite': {
                'name': 'fluorite',
                'first': 93,
                'second': 94
            },
            'rollTwice': {
                'name': 'rollTwice',
                'first': 95,
                'second': 99
            }
        }

        let basaltByProdcts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'agate': {
                'name': 'agate',
                'first': 50,
                'second': 61
            },
            'obsidian': {
                'name': 'obsidian',
                'first': 62,
                'second': 74
            },
            'quartz': {
                'name': 'quartz',
                'first': 75,
                'second': 84
            },
            'amethyst': {
                'name': 'amethyst',
                'first': 85,
                'second': 89
            },
            'fluorite': {
                'name': 'fluorite',
                'first': 90,
                'second': 94
            },
            'rollTwice': {
                'name': 'rollTwice',
                'first': 95,
                'second': 99
            }
        }
        
        let marbelByProducts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'lapis lazuli': {
                'name': 'lapis lazuli',
                'first': 50,
                'second': 89
            },
            'rollOnceGranite': {
                'name': 'rollOnceGranite',
                'first': 90,
                'second': 94
            },
            'rollTwiceGranite': {
                'name': 'rollTwiceGranite',
                'first': 95,
                'second': 99
            }
        }

 
        /*
            iron byproducts
            1-50: nothing
            51-71: hematite
            72-87: rhodochrosite
            88-90: bloodstone
            91-93: carnelian
            94-96: chrysopidate
            97-98: alexandrite
            99-100: jade
*/
        /*
            copper byproducts
            1-50: nothing
            51-66: azurite
            67-82: malachite
            83-100: turquoise
*/

        var tally = 0;
        var minedOutputTotal = {};

        $('button').on('click', function () {
            $('div#summary').html(''); // reset summary output
            $('div#output').html(''); // reset html output
            // $('input#days').attr('disabled', false); // enable day input
            // $('input#minerCount').attr('disabled', false); // enable miner input
            
            var days = parseInt($('input#days').val()); // number of days to simulate
            var minerCount = $('input#minerCount').val(); // number of miners

            if (days > 365) { // limit the amount of days to simulate. When testing, I found performance problems trying to simulate more than one year.
                days = 365;
                $('input#days').val(365);
            }

            tally = 0;
            minedOutputTotal = {};
            var output = '';
            var totals = [];

            for (i in minedOutput) { // set up the object to receive all material names and their worth
                minedOutputTotal[i] = {};
                minedOutputTotal[i].name = i;
                minedOutputTotal[i].worth = [];
            }

            for (var h = 0; h < minerCount; h++) {
                for (var i = 0; i < days; i++) {
                    var minedRnd = rndNum(100);
                    
                    for (k in miningProducts) {
                        if (miningProducts[k].first <= minedRnd && miningProducts[k].second >= minedRnd) {
                            if (k == 'stones') { // randomly pick from stones object
                                minedItems(stones);
                                byproduct('stones');
                            } else if (k == 'metals') {
                                minedItems(metals);
                                // ** add routines for iron and copper byproducts
                                // ** pick up here by copying the routine for byproducts
                            } else if (k == 'exotics') {
                                minedItems(exotics);
                                // ** add routines for byproducts
                            } else if (k == 'gemstones') {
                                // console.log(gemstones)
                                minedItems(gemstones)
                            }

                            break;
                        }
                    }
                }
            }
            
            for (i in minedOutputTotal) {
                if (minedOutputTotal[i].worth.length > 0) {
                    var tally = 0;

                    for (k in minedOutputTotal[i].worth) {
                        tally += minedOutputTotal[i].worth[k];
                    }

                    if (minedOutputTotal[i].name == 'blueSpinel') {
                        output += '<p>blue spinel: ' + numberWithCommas(tally) + 'gp</p>';
                    } else if (minedOutputTotal[i].name == 'redSpinel') {
                        output += '<p>red spinel: ' + numberWithCommas(tally) + 'gp</p>';
                    } else {
                        output += '<p>' + minedOutputTotal[i].name + ': ' + numberWithCommas(tally) + 'gp</p>';
                    }

                    totals.push(tally)
                }
            }

            var grandTotal = 0;

            for (i in totals) {
                grandTotal += totals[i];
            }

            $('div#summary').append('<p><strong>Your mine generated ' + numberWithCommas(grandTotal) + 'gp worth of materials from ' + days + ' days of labor from ' + minerCount + ' miners</strong>.</p>');

            var dragonTipInput = parseInt($('input#percentage_dragonTip').val());
            var minersTipInput = parseInt($('input#percentage_minerTip').val());
            var mineUpkeepInput = parseInt($('input#percentage_mineUpkeep').val());
            var miscExpensesInput = parseInt($('input#percentage_miscExpenses').val());
            var mineExpansionInput = parseInt($('input#percentage_mineExpansion').val());

            var partysCut = 100 - (dragonTipInput + minersTipInput + mineUpkeepInput + miscExpensesInput + mineExpansionInput);

            var mineUpkeep = Math.round(grandTotal * (mineUpkeepInput /100)); // 10% for mine maintainence
            var miscExpenses = Math.round(grandTotal * (miscExpensesInput / 100)); // 6% for mine misc expenses
            var mineExpansion = Math.round(grandTotal * (mineExpansionInput / 100)); // 10% for mine expansion and facility upgrades
            var partyProfit = Math.round(grandTotal * (partysCut / 100)); // 40% is what the party keeps
            
            $('div#summary').append('<p>The dragon get ' + numberWithCommas(Math.round(grandTotal * (dragonTipInput / 100))) + 'gp (' + dragonTipInput + '% tithe).</p>'); // defaults to 30% tithe to the dragon
            $('div#summary').append('<p>The miners get ' + numberWithCommas(Math.round(grandTotal * (minersTipInput / 100))) + 'gp (' + minersTipInput + '% bonus).</p>'); // 4% tip to the miners
            $('div#summary').append('<p>' + (mineUpkeepInput + miscExpensesInput) + '% goes to mine upkeep and misc expenses (' + numberWithCommas(mineUpkeep + miscExpenses) + 'gp).</p>');
            $('div#summary').append('<p>' + mineExpansionInput + '% for mine expansion and facility upgrades (' + numberWithCommas(mineExpansion) + 'gp).</p>');
            $('div#summary').append('<p><strong>The mine owners get '+ numberWithCommas(partyProfit) + 'gp</strong>.</p>');
            $('div#output').append(output);
        });

        $('input').on('change', function () {
            $('div#summary').html('');

            var days = parseInt($('input#days').val()); // number of days to simulate
            var minerCount = $('input#minerCount').val(); // number of miners

            // $('input#days').attr('disabled', true); // disable day input
            // $('input#minerCount').attr('disabled', true); // disable miner input

            var tally = [];
            var output = '';

            for (i in minedOutputTotal) {
                if (minedOutputTotal[i].worth.length > 0) {
                    tally.push(minedOutputTotal[i].worth);
                }
            }

            var grandTotal = 0;

            for (i in tally) {
                for (j in tally[i]) {
                    grandTotal += tally[i][j];
                }
            }

            $('div#summary').append('<p><strong>Your mine generated ' + numberWithCommas(grandTotal) + 'gp worth of materials from ' + days + ' days of labor from ' + minerCount + ' miners</strong>.</p>');

            var dragonTipInput = parseInt($('input#percentage_dragonTip').val());
            var minersTipInput = parseInt($('input#percentage_minerTip').val());
            var mineUpkeepInput = parseInt($('input#percentage_mineUpkeep').val());
            var miscExpensesInput = parseInt($('input#percentage_miscExpenses').val());
            var mineExpansionInput = parseInt($('input#percentage_mineExpansion').val());
            var partysCut = 100 - (dragonTipInput + minersTipInput + mineUpkeepInput + miscExpensesInput + mineExpansionInput);
            var mineUpkeep = Math.round(grandTotal * (mineUpkeepInput /100)); // 10% for mine maintainence
            var miscExpenses = Math.round(grandTotal * (miscExpensesInput / 100)); // 6% for mine misc expenses
            var mineExpansion = Math.round(grandTotal * (mineExpansionInput / 100)); // 10% for mine expansion and facility upgrades
            var partyProfit = Math.round(grandTotal * (partysCut / 100)); // 40% is what the party keeps
            
            $('div#summary').append('<p>The dragon get ' + numberWithCommas(Math.round(grandTotal * (dragonTipInput / 100))) + 'gp (' + dragonTipInput + '% tithe).</p>'); // defaults to 30% tithe to the dragon
            $('div#summary').append('<p>The miners get ' + numberWithCommas(Math.round(grandTotal * (minersTipInput / 100))) + 'gp (' + minersTipInput + '% bonus).</p>'); // 4% tip to the miners
            $('div#summary').append('<p>' + (mineUpkeepInput + miscExpensesInput) + '% goes to mine upkeep and misc expenses (' + numberWithCommas(mineUpkeep + miscExpenses) + 'gp).</p>');
            $('div#summary').append('<p>' + mineExpansionInput + '% for mine expansion and facility upgrades (' + numberWithCommas(mineExpansion) + 'gp).</p>');
            $('div#summary').append('<p><strong>The mine owners get '+ numberWithCommas(partyProfit) + 'gp</strong>.</p>');
            
        });

        function byproduct(material) {
            if (material == 'stones') {
                var stoneByProductTypes = [graniteByProducts, basaltByProdcts, marbelByProducts]
                var rndStone = stoneByProductTypes[rndNum(stoneByProductTypes.length)];
                var roll100 = rndNum(100);

                for (i in rndStone) {
                    if (rndStone[i].first <= roll100 && rndStone[i].second >= roll100) { // pick a random material
                        if (rndStone[i].name == 'nothing') { // skip; do nothing
                        } else if (rndStone[i].name == 'rollTwice') { // roll twice on rndStone object
                            rndMaterial(rndStone);
                            rndMaterial(rndStone);
                        } else if (rndStone[i].name == 'rollOnceGranite') { // roll one granite table
                            rollOnGraniteByProducts();
                        } else if (rndStone[i].name == 'rollTwiceGranite') { // roll twice on granite table
                            rollOnGraniteByProducts();
                            rollOnGraniteByProducts();
                        } else {
                            rndMaterial(rndStone);
                        }
                    }
                }
            }
        }

        function rollOnGraniteByProducts() {
            var rollGraniteByProducts = rndNum(100);

            for (k in graniteByProducts) {
                if (graniteByProducts[k].first <= rollGraniteByProducts && graniteByProducts[k].second >= rollGraniteByProducts) {
                    if (graniteByProducts[k].name != 'nothing' || graniteByProducts[k].name != 'rollTwice') {
                        for (l in minedOutput) {
                            if (minedOutput[l].name == graniteByProducts[k].name) {
                                minedOutputTotal[graniteByProducts[k].name].worth.push(minedOutput[j].gpOutput[rndNum(minedOutput[j].gpOutput.length)]);
                            }
                        }
                    }
                }
            }
        }

        function rndMaterial(obj) {
            for (j in minedOutput) {
                if (minedOutput[j].name == obj[i].name) {
                    var worth = minedOutput[j].gpOutput[rndNum(minedOutput[j].gpOutput.length)];

                    minedOutputTotal[obj[i].name].worth.push(worth);

                    break;
                }
            }
        }
        
        function minedItems(obj) {
            var rndNumber = rndNum(100);

            for (i in obj) {
                if (rndNumber >= obj[i].first && rndNumber <= obj[i].second) {
                    var worth = obj[i].gpOutput[rndNum(obj[i].gpOutput.length)]; // pick value of mined item

                    tally += worth;
                    minedOutputTotal[obj[i].name].worth.push(worth);
                }
            }
        }

        function rndNum(x) {
            return Math.floor(Math.random() * x);
        }

        function numberWithCommas(x) {
            var parts = x.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }

    </script>
</html>