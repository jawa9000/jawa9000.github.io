<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
    <title>Mine Output</title>
    <meta name='description' content='mine output'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name="keywords" content="javascript, random">
    <meta name="author" content="Brian Immel">
    <meta name="level" content="2">
    <meta name="version" content="0.0.1">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">
    <link href="../../css/normalize.css" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet"> -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <style>
        .center {
            text-align: center;
        }
        input {
            width: 60px;
        }
        h1, h2 {
            text-align: center;
        }
        td, th {
            padding: 5px;
        }
        /* table elements */
        table, th, td {
            border: 1px solid black;
            padding: 5px;
        }
        th {
            text-align: center;
            background-color: rgb(101, 97, 148);
            color: white;
        }
        tr:nth-child(odd) {
            background-color: rgb(133, 127, 194);
        }
        tr:nth-child(even) {
            background-color: rgb(169, 165, 209);
        }
        tr:hover {
            background-color: rgb(195, 192, 231);
        }

    </style>
</head>

<body>
    <h1 class="center">Mine Output</h1>
    <div class="container">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <label for="percentage_dragonTip">Dragon's cut (%)</label>
                <input id="percentage_dragonTip" type="number" min="0" step="1" max="100" value="50">
                <label for="percentage_minerTip">Miner's cut (%)</label>
                <input id="percentage_minerTip" type="number" min="0" step="1" max="100" value="2">
                <label for="percentage_mineUpkeep">Mine upkeep (%)</label>
                <input id="percentage_mineUpkeep" type="number" min="0" step="1" max="100" value="12">
                <label for="percentage_miscExpenses">Mine expenses (%)</label>
                <input id="percentage_miscExpenses" type="number" min="0" step="1" max="100" value="6">
                <label for="percentage_mineExpansion">Mine expansion (%)</label>
                <input id="percentage_mineExpansion" type="number" min="0" step="1" max="100" value="10">
                <br/>
                <label for="days">Days</label>
                <input id="days" type="number" min="1" step="1" max="365" value="30">
                <label for="minerCount"># of Miners</label>
                <input id="minerCount" type="number" min="1" step="1" value="10">
                <button>Run</button>
            </div>
            <div class="col-md-1"></div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-6">
                <div id="summary"></div>
                <div id="kept"></div>
            </div>
            <div class="col-md-4">
                <div id="output"></div>
            </div>
            <div class="col-md-1"></div>
        </div>
    </div>
</body>

    <script src="../../js/jquery-2.1.0.min.js"></script>    

    <script>
        /*
            https://angrygolem-games.com/dwarves-mining-4-dd-mining-guide-mining-output/
        */
        let minedOutput = {
            'granite': {
                'name': 'Granite',
                'gpOutput': [0.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6],
                'pricePerPound': 0.1
            },
            'basalt': {
                'name': 'Basalt',
                'gpOutput': [1,2,3,4,5,6,7,8,10,11,12],
                'pricePerPound': 0.2
            },
            'marble': {
                'name': 'Marble',
                'gpOutput': [2,4,8,16,18,20,22,24,26,28,30,32],
                'pricePerPound': 0.4
            },
            'coal': {
                'name': 'Coal',
                'gpOutput': [1,2,3,4,5,6,7,8,9,10,11,12],
                'pricePerPound': 0.2
            },
            'petroleum': {
                'name': 'Petroleum',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'agate': {
                'name': 'agate',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'bloodstone': {
                'name': 'bloodstone',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'canelian': {
                'name': 'canelian',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'citrine': {
                'name': 'citrine',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'jasper': {
                'name': 'jasper',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'moonstone': {
                'name': 'moonstone',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'onyx': {
                'name': 'onyx',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'tourmaline': {
                'name': 'tourmaline',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'zircon': {
                'name': 'zircon',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'fluorite': {
                'name': 'fluorite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'obsidian': {
                'name': 'obsidian',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'quartz': {
                'name': 'quartz',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'amethyst': {
                'name': 'amethyst',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'lapis lazuli': {
                'name': 'lapis lazuli',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'hematite': {
                'name': 'hematite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'rhodochrosite': {
                'name': 'rhodochrosite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'carnelian': {
                'name': 'carnelian',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'chrysopidate': {
                'name': 'chrysopidate',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'alexandrite': {
                'name': 'alexandrite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'jade': {
                'name': 'jade',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'azurite': {
                'name': 'azurite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'malachite': {
                'name': 'malachite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'turquoise': {
                'name': 'turquoise',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'amber': {
                'name': 'amber',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'jet': {
                'name': 'jet',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'blue calcite': {
                'name': 'blue calcite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'aquamarine': {
                'name': 'aquamarine',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'blueSpinel': {
                'name': 'blue spinel',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'peridot': {
                'name': 'peridot',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'topaz': {
                'name': 'topaz',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'garnet': {
                'name': 'garnet',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'jacinth': {
                'name': 'jacinth',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'opal': {
                'name': 'opal',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'redSpinel': {
                'name': 'red spinel',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'sapphire': {
                'name': 'sapphire',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'emerald': {
                'name': 'emerald',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'ruby': {
                'name': 'ruby',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'diamond': {
                'name': 'diamond',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'radioactive': {
                'name': 'radioactive',
                'gpOutput': [4.5,6.5,8.5,10,12.5,14.5,16,18,20,22,25,31],
                'pricePerPound': 500
            },
            'lead': {
                'name': 'Lead',
                'gpOutput': [0.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6],
                'pricePerPound': 0.2
            },
            'zinc': {
                'name': 'Zinc',
                'gpOutput': [1,2,3,4,5,6,7,8,10,11,12],
                'pricePerPound': 0.2
            },
            'iron': {
                'name': 'Iron',
                'gpOutput': [2,3.5,5,6.5,8,9.5,11,12,14,15.5,17,18.5],
                'pricePerPound': 0.4
            },
            'tin': {
                'name': 'Tin',
                'gpOutput': [3.5,5.5,7.5,9.5,11,13.5,15,18,20,21.5,23.5,26],
                'pricePerPound': 0.3
            },
            'copper': {
                'name': 'Copper',
                'gpOutput': [5,7.5,10,12.5,15,17.5,20,22.5,25,27.5,30,32.5],
                'pricePerPound': 0.5
            },
            'silver': {
                'name': 'Silver',
                'gpOutput': [10,15,20,25,30,35,40,45,50,55,60,65],
                'pricePerPound': 5
            },
            'gold': {
                'name': 'Gold',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130],
                'pricePerPound': 50
            },
            'platinum': {
                'name': 'Platinum',
                'gpOutput': [40,65,79,112,136,160,185,210,232,280,305,330],
                'pricePerPound': 500
            },
            'mithril': {
                'name': 'Mithril',
                'gpOutput': [75,105,140,170,205,240,275,310,345,385,415,455],
                'pricePerPound': 2500
            },
            'adamantine': {
                'name': 'Adamantine',
                'gpOutput': [100,150,200,250,300,350,400,450,500,550,600,650],
                'pricePerPound': 5000
            }
        }

        let miningProducts = {
            'stones': {
                'name': 'stones',
                'first': 0,
                'second': 64
            },
            'metals': {
                'name': 'metals',
                'first': 65,
                'second': 82
            },
            'exotics': {
                'name': 'exotics',
                'first': 83,
                'second': 92
            },
            'gemstones': {
                'name': 'gemstones',
                'first': 93,
                'second': 99
            }
        }
        
        let metals = {
            'lead': {
                'name': 'lead',
                'first': 0,
                'second': 4,
                'gpOutput': [0.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6]
            },
            'zinc': {
                'name': 'zinc',
                'first': 5,
                'second': 9,
                'gpOutput': [1,2,3,4,5,6,7,8,10,11,12]
            },
            'iron': {
                'name': 'iron',
                'first': 10,
                'second': 59,
                'byproduct': 'ironTable',
                'gpOutput': [2,3.5,5,6.5,8,9.5,11,12,14,15.5,17,18.5]
            },
            'tin': {
                'name': 'tin',
                'first': 60,
                'second': 69,
                'gpOutput': [3.5,5.5,7.5,9.5,11,13.5,15,18,20,21.5,23.5,26]
            },
            'copper': {
                'name': 'copper',
                'first': 70,
                'second': 84,
                'byproduct': 'copperTable',
                'gpOutput': [5,7.5,10,12.5,15,17.5,20,22.5,25,27.5,30,32.5]
            },
            'silver': {
                'name': 'silver',
                'first': 85,
                'second': 89,
                'gpOutput': [10,15,20,25,30,35,40,45,50,55,60,65]
            },
            'gold': {
                'name': 'gold',
                'first': 90,
                'second': 94,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'platinum': {
                'name': 'platinum',
                'first': 95,
                'second': 96,
                'gpOutput': [80,130,177,225,275,320,370,420,465,560,610,660]
            },
            'mithril': {
                'name': 'mithril',
                'first': 97,
                'second': 98,
                'gpOutput': [150,210,280,340,410,480,550,620,690,770,830,910]
            },
            'adamantine': {
                'name': 'adamantine',
                'first': 99,
                'second': 100,
                'gpOutput': [200,300,400,500,600,700,800,900,1000,1100,1200,1300]
            }
        }

        let stones = {
            'granite': {
                'name': 'granite',
                'first': 0,
                'second': 59,
                'gpOutput': [0.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6]
            },
            'basalt': {
                'name': 'basalt',
                'first': 60,
                'second': 89,
                'gpOutput': [1,2,3,4,5,6,7,8,10,11,12]
            },
            'marble': {
                'name': 'marble',
                'first': 90,
                'second': 99,
                'gpOutput': [2,4,8,16,18,20,22,24,26,28,30,32]
            }
        }

        let exotics = {
            'coal': {
                'name': 'coal',
                'first': 0,
                'second': 59,
                'byproduct': 'amber-jet',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'petroleum': {
                'name': 'petroleum',
                'first': 60,
                'second': 89,
                'byproduct': 'blue calcite',
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'radioactive': {
                'name': 'radioactive',
                'first': 90,
                'second': 99,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            }
        }

        let gemstones = {
            'aquamarine': {
                'name': 'aquamarine',
                'first': 0,
                'second': 14,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'blueSpinel': {
                'name': 'blueSpinel',
                'first': 15,
                'second': 29,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'peridot': {
                'name': 'peridot',
                'first': 30,
                'second': 44,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'topaz': {
                'name': 'topaz',
                'first': 45,
                'second': 59,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'garnet': {
                'name': 'garnet',
                'first': 60,
                'second': 67,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'jacinth': {
                'name': 'jacinth',
                'first': 68,
                'second': 75,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'opal': {
                'name': 'opal',
                'first': 76,
                'second': 83,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'redSpinel': {
                'name': 'redSpinel',
                'first': 84,
                'second': 90,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'sapphire': {
                'name': 'sapphire',
                'first': 91,
                'second': 93,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'emerald': {
                'name': 'emerald',
                'first': 94,
                'second': 95,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'ruby': {
                'name': 'ruby',
                'first': 96,
                'second': 97,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            },
            'diamond': {
                'name': 'diamond',
                'first': 98,
                'second': 99,
                'gpOutput': [17.5,22.5,38.5,50,67,72,87,100,110,117,130]
            }
        }

        let graniteByProducts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'agate': {
                'name': 'agate',
                'first': 50,
                'second': 69
            },
            'bloodstone': {
                'name': 'bloodstone',
                'first': 70,
                'second': 71
            },
            'canelian': {
                'name': 'canelian',
                'first': 72,
                'second': 74
            },
            'citrine': {
                'name': 'citrine',
                'first': 75,
                'second': 77
            },
            'jasper': {
                'name': 'jasper',
                'first': 78,
                'second': 80
            },
            'moonstone': {
                'name': 'moonstone',
                'first': 81,
                'second': 83
            },
            'onyx': {
                'name': 'onyx',
                'first': 84,
                'second': 86
            },
            'tourmaline': {
                'name': 'tourmaline',
                'first': 87,
                'second': 89
            },
            'zircon': {
                'name': 'zircon',
                'first': 90,
                'second': 92
            },
            'fluorite': {
                'name': 'fluorite',
                'first': 93,
                'second': 94
            },
            'rollTwice': {
                'name': 'rollTwice',
                'first': 95,
                'second': 99
            }
        }

        let basaltByProdcts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'agate': {
                'name': 'agate',
                'first': 50,
                'second': 61
            },
            'obsidian': {
                'name': 'obsidian',
                'first': 62,
                'second': 74
            },
            'quartz': {
                'name': 'quartz',
                'first': 75,
                'second': 84
            },
            'amethyst': {
                'name': 'amethyst',
                'first': 85,
                'second': 89
            },
            'fluorite': {
                'name': 'fluorite',
                'first': 90,
                'second': 94
            },
            'rollTwice': {
                'name': 'rollTwice',
                'first': 95,
                'second': 99
            }
        }
        
        let marbelByProducts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'lapis lazuli': {
                'name': 'lapis lazuli',
                'first': 50,
                'second': 89
            },
            'rollOnceGranite': {
                'name': 'rollOnceGranite',
                'first': 90,
                'second': 94
            },
            'rollTwiceGranite': {
                'name': 'rollTwiceGranite',
                'first': 95,
                'second': 99
            }
        }

        let ironByProducts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'hematite': {
                'name': 'hematite',
                'first': 50,
                'second': 70
            },
            'rhodochrosite': {
                'name': 'rhodochrosite',
                'first': 71,
                'second': 86
            },
            'bloodstone': {
                'name': 'bloodstone',
                'first': 87,
                'second': 89
            },
            'carnelian': {
                'name': 'carnelian',
                'first': 90,
                'second': 92
            },
            'chrysopidate': {
                'name': 'chrysopidate',
                'first': 93,
                'second': 95
            },
            'alexandrite': {
                'name': 'alexandrite',
                'first': 96,
                'second': 97
            },
            'jade': {
                'name': 'jade',
                'first': 98,
                'second': 99
            }
        }

        let copperByProducts = {
            'nothing': {
                'name': 'nothing',
                'first': 0,
                'second': 49
            },
            'azurite': {
                'name': 'azurite',
                'first': 50,
                'second': 65
            },
            'malachite': {
                'name': 'malachite',
                'first': 66,
                'second': 81
            },
            'turquoise': {
                'name': 'turquoise',
                'first': 82,
                'second': 00
            }
        }
  

        var tally = 0;
        var minedOutputTotal = {};

        $('button').on('click', function () {
            var days = parseInt($('input#days').val()); // number of days to simulate
            var minerCount = $('input#minerCount').val(); // number of miners

            if (days > 365) { // limit the amount of days to simulate. When testing, I found performance problems trying to simulate more than one year.
                days = 365;
                $('input#days').val(365);
            }

            tally = 0;
            minedOutputTotal = {};
            var output = '';
            var totals = [];

            for (i in minedOutput) { // set up the object to receive all material names and their worth
                minedOutputTotal[i] = {};
                minedOutputTotal[i].name = i;
                minedOutputTotal[i].worth = [];
            }

            for (var h = 0; h < minerCount; h++) {
                for (var i = 0; i < days; i++) {
                    var minedRnd = rndNum(100);
                    
                    for (k in miningProducts) {
                        if (miningProducts[k].first <= minedRnd && miningProducts[k].second >= minedRnd) {
                            if (k == 'stones') { // randomly pick from stones object
                                minedItems(stones);
                                byproduct('stones');
                            } else if (k == 'metals') {
                                minedItems(metals);
                                byproduct('metals');
                            } else if (k == 'exotics') {
                                minedItems(exotics);
                                byproduct('exotic');
                            } else if (k == 'gemstones') {
                                minedItems(gemstones)
                            }

                            break;
                        }
                    }
                }
            }
            
            for (i in minedOutputTotal) {
                if (minedOutputTotal[i].worth.length > 0) {
                    var tally = 0;

                    for (k in minedOutputTotal[i].worth) {
                        tally += minedOutputTotal[i].worth[k];
                    }

                    if (minedOutputTotal[i].name == 'blueSpinel') {
                        output += '<p><input type="checkbox" id="blueSpinel" name="blueSpinel" checked>blue spinel:<span id="' + i + '">' + numberWithCommas(tally) + '</span>gp</p>';
                    } else if (minedOutputTotal[i].name == 'redSpinel') {
                        output += '<p><input type="checkbox" id="redSpinel" name="redSpinel" checked>red spinel:<span id="' + i + '">' + numberWithCommas(tally) + '</span>gp</p>';
                    } else {
                        output += '<p><input type="checkbox" id="' + minedOutputTotal[i].name + '" name="' + minedOutputTotal[i].name + '" checked><span id="' + i + '">' + minedOutputTotal[i].name + ': ' + numberWithCommas(tally) + '</span>gp</p>';
                    }

                    totals.push(tally)
                }
            }

            var grandTotal = 0;

            for (i in totals) {
                grandTotal += totals[i];
            }

            var dragonTipInput = parseInt($('input#percentage_dragonTip').val());
            var minersTipInput = parseInt($('input#percentage_minerTip').val());
            var mineUpkeepInput = parseInt($('input#percentage_mineUpkeep').val());
            var miscExpensesInput = parseInt($('input#percentage_miscExpenses').val());
            var mineExpansionInput = parseInt($('input#percentage_mineExpansion').val());

            var partysCut = 100 - (dragonTipInput + minersTipInput + mineUpkeepInput + miscExpensesInput + mineExpansionInput);

            var mineUpkeep = Math.round(grandTotal * (mineUpkeepInput /100)); // 10% for mine maintainence
            var miscExpenses = Math.round(grandTotal * (miscExpensesInput / 100)); // 6% for mine misc expenses
            var mineExpansion = Math.round(grandTotal * (mineExpansionInput / 100)); // 10% for mine expansion and facility upgrades
            var partyProfit = Math.round(grandTotal * (partysCut / 100)); // 40% is what the party keeps
            
            $('div#output').html(''); // reset html output
            $('div#output').append(output);
            updateSumamry(output);
        });


        $('div#output').on('change', 'input:checkbox', function() {
            updateSumamry();
        });

        
        $('input').on('change', function() {
            updateSumamry(); 
        });

        function updateSumamry(output) {
            $('div#summary').html(''); // reset summary output

            var days = parseInt($('input#days').val()); // number of days to simulate
            var minerCount = $('input#minerCount').val(); // number of miners
            var tally = [];
            var output = '';

            var kept = [];

            for (i in minedOutputTotal) {
                if (minedOutputTotal[i].worth.length > 0) {
                    // check to see if the checkbox for the item has been unchecked
                    $('input:checkbox').each(function() {
                        var id = $(this).attr('id');
                        var status = $(this).prop('checked'); // true or false
                        if (status == true) {
                            tally.push(minedOutputTotal[i].worth);
                            
                        } else {
                            kept.push(id)
                        }
                    });
                }
            }

            var keptOutput = '';
            var cleanKept = [...new Set(kept)];

            for (i in cleanKept) {
                for (j in minedOutput) {
                    if (j == cleanKept[i]) {
                        var totalValue = $('span#' + j).text().split(' ')[1].replace(/,/g, '');
                        var pounds = totalValue / minedOutput[j].pricePerPound;

                        keptOutput += '<p>Your mine kept ' + numberWithCommas(pounds) + 'lbs of ' + kept[i] + '.</p>';
                        break;
                    }
                }
            }

            $('div#kept').html('');
            $('div#kept').append(keptOutput)

            var grandTotal = 0;

            for (i in tally) {
                for (j in tally[i]) {
                    grandTotal += tally[i][j];
                }
            }

            var dragonTipInput = parseInt($('input#percentage_dragonTip').val());
            var minersTipInput = parseInt($('input#percentage_minerTip').val());
            var mineUpkeepInput = parseInt($('input#percentage_mineUpkeep').val());
            var miscExpensesInput = parseInt($('input#percentage_miscExpenses').val());
            var mineExpansionInput = parseInt($('input#percentage_mineExpansion').val());
            var partysCut = 100 - (dragonTipInput + minersTipInput + mineUpkeepInput + miscExpensesInput + mineExpansionInput);
            var mineUpkeep = Math.round(grandTotal * (mineUpkeepInput /100)); // 10% for mine maintainence
            var miscExpenses = Math.round(grandTotal * (miscExpensesInput / 100)); // 6% for mine misc expenses
            var mineExpansion = Math.round(grandTotal * (mineExpansionInput / 100)); // 10% for mine expansion and facility upgrades
            var partyProfit = Math.round(grandTotal * (partysCut / 100)); // 40% is what the party keeps

            updateTotalDisplay(grandTotal, minerCount, output, days);
        }

        function updateTotalDisplay(grandTotal, minerCount, output, days) {
            var dragonTipInput = parseInt($('input#percentage_dragonTip').val());
            var minersTipInput = parseInt($('input#percentage_minerTip').val());
            var mineUpkeepInput = parseInt($('input#percentage_mineUpkeep').val());
            var miscExpensesInput = parseInt($('input#percentage_miscExpenses').val());
            var mineExpansionInput = parseInt($('input#percentage_mineExpansion').val());

            var partysCut = 100 - (dragonTipInput + minersTipInput + mineUpkeepInput + miscExpensesInput + mineExpansionInput);

            var mineUpkeep = Math.round(grandTotal * (mineUpkeepInput /100)); // 10% for mine maintainence
            var miscExpenses = Math.round(grandTotal * (miscExpensesInput / 100)); // 6% for mine misc expenses
            var mineExpansion = Math.round(grandTotal * (mineExpansionInput / 100)); // 10% for mine expansion and facility upgrades
            var partyProfit = Math.round(grandTotal * (partysCut / 100)); // 40% is what the party keeps
            
            $('div#summary').append('<p><strong>Your mine generated <span id="grandTotal">' + numberWithCommas(grandTotal) + '</span>gp worth of materials from ' + days + ' days of labor from ' + minerCount + ' miners</strong>.</p>');
            $('div#summary').append('<p>The dragon get <span id="dragonTipInput">' + numberWithCommas(Math.round(grandTotal * (dragonTipInput / 100))) + '</span>gp (' + dragonTipInput + '% tithe).</p>'); // defaults to 30% tithe to the dragon
            $('div#summary').append('<p>The miners get <span id="minersBonus">' + numberWithCommas(Math.round(grandTotal * (minersTipInput / 100))) + '</span>gp (' + minersTipInput + '% bonus).</p>'); // 4% tip to the miners
            $('div#summary').append('<p>' + (mineUpkeepInput + miscExpensesInput) + '% goes to mine upkeep and misc expenses (<span id="upkeep">' + numberWithCommas(mineUpkeep + miscExpenses) + '</span>gp).</p>');
            $('div#summary').append('<p>' + mineExpansionInput + '% for mine expansion and facility upgrades (<span id="mineExpansion">' + numberWithCommas(mineExpansion) + '</span>gp).</p>');
            $('div#summary').append('<p><strong>The mine owners get <span id="partyProfit">' + numberWithCommas(partyProfit) + '</span>gp</strong> (<span id="partyProfitEach">' + numberWithCommas(Math.round(partyProfit/3)) + '</span> each).</p>');
            
            $('div#output').append(output);
        }

        function byproduct(material) {
            if (material == 'stones') {
                var stoneByProductTypes = [graniteByProducts, basaltByProdcts, marbelByProducts]
                var rndStone = stoneByProductTypes[rndNum(stoneByProductTypes.length)];
                var roll100 = rndNum(100);

                for (i in rndStone) {
                    if (rndStone[i].first <= roll100 && rndStone[i].second >= roll100) { // pick a random material
                        if (rndStone[i].name == 'nothing') { // skip; do nothing
                        } else if (rndStone[i].name == 'rollTwice') { // roll twice on rndStone object
                            rndMaterial(rndStone);
                            rndMaterial(rndStone);
                        } else if (rndStone[i].name == 'rollOnceGranite') { // roll one granite table
                            rollOnGraniteByProducts();
                        } else if (rndStone[i].name == 'rollTwiceGranite') { // roll twice on granite table
                            rollOnGraniteByProducts();
                            rollOnGraniteByProducts();
                        } else {
                            rndMaterial(rndStone);
                        }
                    }
                }
            } else if (material == 'metals') {
                var metalByProductTypes = [ironByProducts, copperByProducts];
                var rndMetal = metalByProductTypes[rndNum(metalByProductTypes.length)];
                var roll100 = rndNum(100);

                for (i in rndMetal) {
                    if (rndMetal[i] != 'nothing') {
                        var rollRndMetalByProducts = rndNum(100);

                        for (k in rndMetal) {
                            if (rndMetal[k].first <= rollRndMetalByProducts && rndMetal[k].second >= rollRndMetalByProducts) {
                                rndMaterial(rndMetal);
                            }
                        }
                    }
                }
            } else if (material == 'exotic') {
                var exoticByProductTypes = ['amber', 'jet', 'blue calcite'];
                var rndExotic = exoticByProductTypes[rndNum(exoticByProductTypes.length)];
                
                for (i in minedOutput) {
                    if (minedOutput[i].name == rndExotic) {
                        var worth = minedOutput[i].gpOutput[rndNum(minedOutput[i].gpOutput.length)];
                        minedOutputTotal[rndExotic].worth.push(worth);
                    }
                }
            }
        }

        function rollOnGraniteByProducts() {
            var rollGraniteByProducts = rndNum(100);

            for (k in graniteByProducts) {
                if (graniteByProducts[k].first <= rollGraniteByProducts && graniteByProducts[k].second >= rollGraniteByProducts) {
                    if (graniteByProducts[k].name != 'nothing' || graniteByProducts[k].name != 'rollTwice') {
                        for (l in minedOutput) {
                            if (minedOutput[l].name == graniteByProducts[k].name) {
                                minedOutputTotal[graniteByProducts[k].name].worth.push(minedOutput[l].gpOutput[rndNum(minedOutput[l].gpOutput.length)]);
                            }
                        }
                    }
                }
            }
        }

        function rndMaterial(obj) {
            for (j in minedOutput) {
                if (minedOutput[j].name == obj[i].name) {
                    var worth = minedOutput[j].gpOutput[rndNum(minedOutput[j].gpOutput.length)];

                    minedOutputTotal[obj[i].name].worth.push(worth);

                    break;
                }
            }
        }
        
        function minedItems(obj) {
            var rndNumber = rndNum(100);

            for (i in obj) {
                if (rndNumber >= obj[i].first && rndNumber <= obj[i].second) {
                    var worth = obj[i].gpOutput[rndNum(obj[i].gpOutput.length)]; // pick value of mined item

                    tally += worth;
                    minedOutputTotal[obj[i].name].worth.push(worth);
                }
            }
        }

        function rndNum(x) {
            return Math.floor(Math.random() * x);
        }

        function numberWithCommas(x) {
            var parts = x.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }

    </script>
</html>