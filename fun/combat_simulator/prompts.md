
## Phase 1: Dynamic 3D Map Initialization and Sizing

This phase focuses on implementing the requested map size calculation: determining monster volume to set the battlefield dimensions (X, Y, Z).

| Instruction Set | Developer Task | AI-Copilot Focus |
| :--- | :--- | :--- |
| **1. Calculate Monster Volume ($\text{ft}^3$)** | Create a new helper function, `calculateMonsterVolume(combatant)`, that uses the monster's size properties (`size_cells`, `size_depth`) to calculate its space in cubic feet. | Verify the formula: $\text{Volume} = (5 \times \text{size\_cells}) \times (5 \times \text{size\_cells}) \times (5 \times \text{size\_depth})$. Ensure `size_depth` defaults to `size_cells` (1 for Medium, 2 for Large, etc.). |
| **2. Calculate Total Team Volume** | Create `calculateTotalTeamVolume(team)` that sums the volume of all monsters on a given team. | Debugging: If any monster is missing a required size property, ensure the calculation defaults to $5 \times 5 \times 5$ feet (125 $\text{ft}^3$). |
| **3. Determine Characteristic Distance ($\text{Dist}$)** | Implement a method that finds the maximum volume between Team A and Team B, $\text{Vol}_{\text{max}}$. Then, calculate the characteristic distance: $$\text{Dist} = \text{roundUpToNearest5}(\sqrt[3]{\text{Vol}_{\text{max}}})$$ | Ensure the rounding function correctly snaps the result up to the nearest multiple of 5 (e.g., 27.5 rounds up to 30). |
| **4. Final Map Dimensions** | Update the `calculateMapDimensions()` method (called in `startCombat`) to use the $\text{Dist}$ value. Calculate total dimensions in feet using the formula: $$\text{Total Side Length} = (4 \times \text{Dist}) + (\text{Largest Team Width}) $$ Use the largest monster's size across both teams for "Largest Team Width" (e.g., if a Gargantuan is present, use 20 ft.). <br> Finally, convert feet to cells: `MAP_WIDTH = MAP_HEIGHT = MAP_DEPTH = Total Side Length / 5`. | Verification: Check edge cases. If $\text{Dist}$ is $25 \text{ ft}$ and the max width is $20 \text{ ft}$, the total side length should be $120 \text{ ft}$ ($4 \times 25 + 20$), and the map size should be $24 \times 24 \times 24$ cells. |